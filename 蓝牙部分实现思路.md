# 蓝牙部分实现思路

## 蓝牙连接
&emsp;在Orange Pi开发板上使用Bluez的命令工具配置并启动蓝牙服务，方法见实验的pdf文档。<br>
&emsp;使用Bluez的rfcomm工具程序创建两条连接通道1和2，产生的终端设备号分别为rfcomm0和rfcomm1，其中通道1用来客户端写数据，服务端读数据，通道2用来服务端写数据，客户端读数据。<br>

## 参数传递

&emsp;设置传参数组t，最大传参空间为128个int。<br>
&emsp;服务端传参时，使用t[0]表示不同的传参事件。<br>
&emsp;客户端传参时，仅使用t[0]传递自身板的位置。<br>

- 服务端：

&emsp;1. 当游戏因为弹球未被木板接住而结束时，`将t[0]置为0`，并传递 1 个参数给客户端<br>

&emsp;2. 当服务端玩家点击开始游戏时，`将t[0]置为1`，t[1]、t[2]、t[3]、t[4]分别存放服务端木板的位置、球的初始x坐标、球的初始速度x分量、球的初始速度y分量，并传递 5 个参数给客户端<br>

&emsp;3. 当服务端玩家在游戏中点击或滑动屏幕时，`将t[0]置为2`，t[1]存放服务端木板的新位置，并传递2个参数给客户端<br>

&emsp;4. 当在游戏中球与墙壁或者木板发生碰撞时，`将t[0]置为3`，t[1]、t[2]、t[3]、t[4]、t[5]、t[6]分别存放服务端木板的位置、碰撞后球的x坐标、球的y坐标、球的速度x分量、球的速度y分量、碰撞后球的最大速度，并传递7个参数给客户端<br>

- 客户端：

&emsp;1. 当客户端玩家在游戏中点击或滑动屏幕时，将t[0]置为客户端木板的新位置，并传递 1 个参数给服务端<br>

## 读取参数

&emsp;复用传参数组t<br>
&emsp;服务端每次仅读取一个参数到t中<br>
&emsp;客户端每次读取至多七个参数到t中，根据读到的第一个参数t[0]判断事件类型。<br>

- 服务端：

&emsp;1. 当蓝牙文件可读时，每次从文件中读出一个整形数t[0],并依次更新客户端木板的位置。<br>

- 客户端：

&emsp;1. 当读到的t[0]为0时，表示游戏结束，更新客户端游戏状态<br>

&emsp;2. 当读到的t[0]为1时，表示游戏开始，更新游戏状态和服务端板的位置t[1]，并使用t[2]、t[3]、t[4]和常数初始化球的位置、速度、最大速度和半径。<br>

&emsp;3. 当读到的t[0]为2时，表示服务端木板发生移动，使用t[1]更新服务端木板位置。<br>

&emsp;4. 当读到的t[0]为3时，表示球发生碰撞，使用t[1]、t[2]、t[3]、t[4]、t[5]、[6]更新球的位置、速度和最大速度。<br>